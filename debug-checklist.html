<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ãƒ‡ãƒãƒƒã‚°ãƒã‚§ãƒƒã‚¯ãƒªã‚¹ãƒˆ</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .checklist { background-color: #f8f9fa; padding: 20px; border-radius: 5px; margin: 10px 0; }
        .check-item { margin: 10px 0; padding: 10px; border-left: 4px solid #007bff; background-color: white; }
        .check-item.error { border-left-color: #dc3545; background-color: #f8d7da; }
        .check-item.success { border-left-color: #28a745; background-color: #d4edda; }
        .check-item.warning { border-left-color: #ffc107; background-color: #fff3cd; }
        button { padding: 10px 15px; margin: 5px; cursor: pointer; background-color: #007bff; color: white; border: none; border-radius: 3px; }
        button:hover { background-color: #0056b3; }
        .code { background-color: #f1f1f1; padding: 10px; border-radius: 3px; font-family: monospace; margin: 10px 0; }
    </style>
</head>
<body>
    <h1>ğŸ”§ äºˆç´„ã‚·ã‚¹ãƒ†ãƒ  ãƒ‡ãƒãƒƒã‚°ãƒã‚§ãƒƒã‚¯ãƒªã‚¹ãƒˆ</h1>
    
    <div class="checklist">
        <h2>1. è¨­å®šã®ç¢ºèª</h2>
        <div id="configCheck" class="check-item">ç¢ºèªä¸­...</div>
    </div>
    
    <div class="checklist">
        <h2>2. æ¥ç¶šãƒ†ã‚¹ãƒˆ</h2>
        <button onclick="testConnection()">æ¥ç¶šãƒ†ã‚¹ãƒˆå®Ÿè¡Œ</button>
        <div id="connectionResult" class="check-item">æœªå®Ÿè¡Œ</div>
    </div>
    
    <div class="checklist">
        <h2>3. ç›´æ¥ã‚¢ã‚¯ã‚»ã‚¹ãƒ†ã‚¹ãƒˆ</h2>
        <button onclick="testDirectAccess()">ç›´æ¥ã‚¢ã‚¯ã‚»ã‚¹ãƒ†ã‚¹ãƒˆå®Ÿè¡Œ</button>
        <div id="directAccessResult" class="check-item">æœªå®Ÿè¡Œ</div>
    </div>
    
    <div class="checklist">
        <h2>4. äºˆç´„ãƒ†ã‚¹ãƒˆ</h2>
        <button onclick="testReservation()">äºˆç´„ãƒ†ã‚¹ãƒˆå®Ÿè¡Œ</button>
        <div id="reservationResult" class="check-item">æœªå®Ÿè¡Œ</div>
    </div>
    
    <div class="checklist">
        <h2>5. Google Apps Scriptè¨­å®šãƒã‚§ãƒƒã‚¯ãƒªã‚¹ãƒˆ</h2>
        <div class="check-item">
            <h3>âœ… ç¢ºèªã™ã¹ãé …ç›®:</h3>
            <ol>
                <li><strong>Webã‚¢ãƒ—ãƒªã¨ã—ã¦å…¬é–‹ã•ã‚Œã¦ã„ã‚‹ã‹</strong>
                    <div class="code">
                        1. Google Apps Scriptã‚¨ãƒ‡ã‚£ã‚¿ã‚’é–‹ã<br>
                        2. ã€Œãƒ‡ãƒ—ãƒ­ã‚¤ã€â†’ã€Œæ–°ã—ã„ãƒ‡ãƒ—ãƒ­ã‚¤ã€<br>
                        3. ç¨®é¡: ã€ŒWebã‚¢ãƒ—ãƒªã€ã‚’é¸æŠ<br>
                        4. èª¬æ˜: é©å½“ãªèª¬æ˜ã‚’å…¥åŠ›<br>
                        5. ã€Œãƒ‡ãƒ—ãƒ­ã‚¤ã€ã‚’ã‚¯ãƒªãƒƒã‚¯
                    </div>
                </li>
                <li><strong>ã‚¢ã‚¯ã‚»ã‚¹æ¨©é™ãŒã€Œå…¨å“¡ã€ã«è¨­å®šã•ã‚Œã¦ã„ã‚‹ã‹</strong>
                    <div class="code">
                        1. ãƒ‡ãƒ—ãƒ­ã‚¤ä½œæˆæ™‚ã«ã€Œã‚¢ã‚¯ã‚»ã‚¹æ¨©é™ã€ã‚’ã€Œå…¨å“¡ï¼ˆåŒ¿åãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚’å«ã‚€ï¼‰ã€ã«è¨­å®š<br>
                        2. æ—¢å­˜ã®ãƒ‡ãƒ—ãƒ­ã‚¤ã®å ´åˆã¯ã€Œç·¨é›†ã€â†’ã€Œã‚¢ã‚¯ã‚»ã‚¹æ¨©é™ã€ã‚’å¤‰æ›´
                    </div>
                </li>
                <li><strong>URLãŒæ­£ã—ã„ã‹</strong>
                    <div class="code">
                        æ­£ã—ã„å½¢å¼: https://script.google.com/macros/s/[SCRIPT_ID]/exec<br>
                        é–“é•ã£ãŸå½¢å¼: https://script.google.com/macros/s/[SCRIPT_ID]/dev
                    </div>
                </li>
                <li><strong>ã‚³ãƒ¼ãƒ‰ãŒæ­£ã—ãä¿å­˜ã•ã‚Œã¦ã„ã‚‹ã‹</strong>
                    <div class="code">
                        1. ã‚³ãƒ¼ãƒ‰ã‚’ä¿å­˜ï¼ˆCtrl+Sï¼‰<br>
                        2. ã‚¨ãƒ©ãƒ¼ãŒãªã„ã‹ç¢ºèª<br>
                        3. æ–°ã—ã„ãƒ‡ãƒ—ãƒ­ã‚¤ã‚’ä½œæˆ
                    </div>
                </li>
            </ol>
        </div>
    </div>

    <script src="config.js"></script>
    <script>
        function checkConfig() {
            var configCheck = document.getElementById('configCheck');
            var issues = [];
            
            // GAS_API_URLã®ç¢ºèª
            if (typeof GAS_API_URL === 'undefined') {
                issues.push('GAS_API_URLãŒå®šç¾©ã•ã‚Œã¦ã„ã¾ã›ã‚“');
            } else if (!GAS_API_URL) {
                issues.push('GAS_API_URLãŒç©ºã§ã™');
            } else if (!GAS_API_URL.includes('script.google.com')) {
                issues.push('GAS_API_URLã®å½¢å¼ãŒæ­£ã—ãã‚ã‚Šã¾ã›ã‚“');
            } else if (!GAS_API_URL.includes('/exec')) {
                issues.push('GAS_API_URLãŒ/execã§çµ‚ã‚ã£ã¦ã„ã¾ã›ã‚“ï¼ˆ/devã«ãªã£ã¦ã„ã¾ã›ã‚“ã‹ï¼Ÿï¼‰');
            }
            
            // fetch APIã®ç¢ºèª
            if (typeof fetch === 'undefined') {
                issues.push('fetch APIãŒåˆ©ç”¨ã§ãã¾ã›ã‚“ï¼ˆãƒ–ãƒ©ã‚¦ã‚¶ãŒå¤ã™ãã¾ã™ï¼‰');
            }
            
            if (issues.length === 0) {
                configCheck.className = 'check-item success';
                configCheck.innerHTML = 'âœ… è¨­å®šã¯æ­£å¸¸ã§ã™<br>GAS_API_URL: ' + GAS_API_URL;
            } else {
                configCheck.className = 'check-item error';
                configCheck.innerHTML = 'âŒ è¨­å®šã«å•é¡ŒãŒã‚ã‚Šã¾ã™:<br>' + issues.join('<br>');
            }
        }
        
        function testConnection() {
            var result = document.getElementById('connectionResult');
            result.className = 'check-item';
            result.innerHTML = 'æ¥ç¶šãƒ†ã‚¹ãƒˆä¸­...';
            
            if (typeof GAS_API_URL === 'undefined' || !GAS_API_URL) {
                result.className = 'check-item error';
                result.innerHTML = 'âŒ GAS_API_URLãŒè¨­å®šã•ã‚Œã¦ã„ã¾ã›ã‚“';
                return;
            }
            
            var testUrl = GAS_API_URL + '?action=getInitialData';
            console.log('Testing connection to:', testUrl);
            
            fetch(testUrl, { method: 'GET', mode: 'cors' })
            .then(response => {
                console.log('Response status:', response.status);
                if (response.ok) {
                    result.className = 'check-item success';
                    result.innerHTML = 'âœ… æ¥ç¶šæˆåŠŸ (Status: ' + response.status + ')';
                } else {
                    result.className = 'check-item error';
                    result.innerHTML = 'âŒ æ¥ç¶šå¤±æ•— (Status: ' + response.status + ')<br>è€ƒãˆã‚‰ã‚Œã‚‹åŸå› :<br>1. Webã‚¢ãƒ—ãƒªã¨ã—ã¦å…¬é–‹ã•ã‚Œã¦ã„ãªã„<br>2. ã‚¢ã‚¯ã‚»ã‚¹æ¨©é™ãŒã€Œå…¨å“¡ã€ã«è¨­å®šã•ã‚Œã¦ã„ãªã„<br>3. URLãŒé–“é•ã£ã¦ã„ã‚‹';
                }
            })
            .catch(error => {
                console.error('Connection error:', error);
                result.className = 'check-item error';
                result.innerHTML = 'âŒ æ¥ç¶šã‚¨ãƒ©ãƒ¼: ' + error.message + '<br>è€ƒãˆã‚‰ã‚Œã‚‹åŸå› :<br>1. CORSã‚¨ãƒ©ãƒ¼<br>2. ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã‚¨ãƒ©ãƒ¼<br>3. Google Apps Scriptã®è¨­å®šå•é¡Œ';
            });
        }
        
        function testDirectAccess() {
            var result = document.getElementById('directAccessResult');
            result.className = 'check-item';
            result.innerHTML = 'ç›´æ¥ã‚¢ã‚¯ã‚»ã‚¹ãƒ†ã‚¹ãƒˆä¸­...';
            
            if (typeof GAS_API_URL === 'undefined' || !GAS_API_URL) {
                result.className = 'check-item error';
                result.innerHTML = 'âŒ GAS_API_URLãŒè¨­å®šã•ã‚Œã¦ã„ã¾ã›ã‚“';
                return;
            }
            
            var testUrl = GAS_API_URL + '?action=getInitialData';
            console.log('Opening direct access URL:', testUrl);
            
            try {
                var newWindow = window.open(testUrl, '_blank');
                if (newWindow) {
                    result.className = 'check-item success';
                    result.innerHTML = 'âœ… æ–°ã—ã„ã‚¿ãƒ–ã§é–‹ãã¾ã—ãŸ<br>URL: ' + testUrl + '<br><br>æ–°ã—ã„ã‚¿ãƒ–ã§JSONãƒ¬ã‚¹ãƒãƒ³ã‚¹ãŒè¡¨ç¤ºã•ã‚Œã‚Œã°æ­£å¸¸ã§ã™ã€‚';
                } else {
                    result.className = 'check-item error';
                    result.innerHTML = 'âŒ ãƒãƒƒãƒ—ã‚¢ãƒƒãƒ—ãŒãƒ–ãƒ­ãƒƒã‚¯ã•ã‚Œã¾ã—ãŸ<br>ãƒ–ãƒ©ã‚¦ã‚¶ã®ãƒãƒƒãƒ—ã‚¢ãƒƒãƒ—ãƒ–ãƒ­ãƒƒã‚¯ã‚’ç„¡åŠ¹ã«ã—ã¦ãã ã•ã„ã€‚';
                }
            } catch (error) {
                result.className = 'check-item error';
                result.innerHTML = 'âŒ ã‚¨ãƒ©ãƒ¼: ' + error.message;
            }
        }
        
        function testReservation() {
            var result = document.getElementById('reservationResult');
            result.className = 'check-item';
            result.innerHTML = 'äºˆç´„ãƒ†ã‚¹ãƒˆä¸­...';
            
            if (typeof GAS_API_URL === 'undefined' || !GAS_API_URL) {
                result.className = 'check-item error';
                result.innerHTML = 'âŒ GAS_API_URLãŒè¨­å®šã•ã‚Œã¦ã„ã¾ã›ã‚“';
                return;
            }
            
            var testData = {
                name: 'ãƒ†ã‚¹ãƒˆå¤ªéƒ',
                phone: '090-1234-5678',
                email: 'test@example.com',
                startTime: new Date().toISOString(),
                courseDuration: 90,
                courseNameOnly: 'ã‚¸ã‚§ãƒ«ãƒã‚¤ãƒ«',
                coursePrice: 8000,
                menuType: 'ã‚¸ã‚§ãƒ«ãƒã‚¤ãƒ«',
                visitStatus: 'åˆå›',
                isNailOff: false,
                lengthExtensionCount: 0,
                lengthExtensionPrice: 0,
                isStaffAssignment: false,
                selectedStaff: '',
                staffAssignmentPrice: 0,
                imageFile: null
            };
            
            console.log('Testing reservation with data:', testData);
            
            fetch(GAS_API_URL, {
                method: 'POST',
                mode: 'cors',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(testData)
            })
            .then(response => {
                console.log('Reservation response status:', response.status);
                return response.text();
            })
            .then(text => {
                console.log('Reservation response text:', text);
                try {
                    var result = JSON.parse(text);
                    if (result.success) {
                        document.getElementById('reservationResult').className = 'check-item success';
                        document.getElementById('reservationResult').innerHTML = 'âœ… äºˆç´„ãƒ†ã‚¹ãƒˆæˆåŠŸ<br>ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸: ' + result.message;
                    } else {
                        document.getElementById('reservationResult').className = 'check-item error';
                        document.getElementById('reservationResult').innerHTML = 'âŒ äºˆç´„ãƒ†ã‚¹ãƒˆå¤±æ•—<br>ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸: ' + result.message;
                    }
                } catch (e) {
                    document.getElementById('reservationResult').className = 'check-item error';
                    document.getElementById('reservationResult').innerHTML = 'âŒ JSONè§£æã‚¨ãƒ©ãƒ¼<br>ãƒ¬ã‚¹ãƒãƒ³ã‚¹: ' + text.substring(0, 200);
                }
            })
            .catch(error => {
                console.error('Reservation test error:', error);
                result.className = 'check-item error';
                result.innerHTML = 'âŒ äºˆç´„ãƒ†ã‚¹ãƒˆã‚¨ãƒ©ãƒ¼: ' + error.message;
            });
        }
        
        // ãƒšãƒ¼ã‚¸èª­ã¿è¾¼ã¿æ™‚ã«è¨­å®šã‚’ãƒã‚§ãƒƒã‚¯
        window.onload = function() {
            checkConfig();
        };
    </script>
</body>
</html>