<!DOCTYPE html>
<html lang="ja">
<head>
    <base target="_top">
    <!--[if lt IE 9]>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html5shiv/3.7.3/html5shiv.min.js"></script>
    <![endif]-->
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <!--[if lt IE 9]>
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <![endif]-->
    <meta name="description" content="ネイルサロンCARATの予約管理システム。オンラインで簡単にご予約いただけます。">
    <meta name="keywords" content="ネイルサロン,予約,オンライン予約,CARAT,大阪">
    <meta name="author" content="CARAT">
    <meta name="robots" content="index, follow">
    
    <!-- Open Graph / Facebook -->
    <meta property="og:type" content="website">
    <meta property="og:title" content="予約管理システム - CARAT">
    <meta property="og:description" content="ネイルサロンCARATの予約管理システム。オンラインで簡単にご予約いただけます。">
    <meta property="og:url" content="https://your-username.github.io/your-repo-name">
    
    <!-- Twitter -->
    <meta property="twitter:card" content="summary_large_image">
    <meta property="twitter:title" content="予約管理システム - CARAT">
    <meta property="twitter:description" content="ネイルサロンCARATの予約管理システム。オンラインで簡単にご予約いただけます。">
    
    <!-- Favicon -->
    <link rel="icon" type="image/x-icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>💅</text></svg>">
    
    <!-- PWA Manifest -->
    <link rel="manifest" href="manifest.json">
    <meta name="theme-color" content="#007bff">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">
    <meta name="apple-mobile-web-app-title" content="CARAT予約">
    
    <!-- Preload critical resources -->
    <link rel="preload" href="https://cdn.jsdelivr.net/npm/fullcalendar@6.1.15/index.global.min.js" as="script">
    <link rel="preload" href="styles.css" as="style">
    <link rel="preload" href="app.js" as="script">
    
    <!--[if lt IE 9]>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/es5-shim/4.5.9/es5-shim.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/es5-shim/4.5.9/es5-sham.min.js"></script>
    <![endif]-->
    <script src='https://cdn.jsdelivr.net/npm/fullcalendar@6.1.15/index.global.min.js' defer></script>
    <link rel="stylesheet" href="styles.css">
    <script src="config.js"></script>
    <script>
        // 設定が読み込まれたかチェック
        if (typeof console !== 'undefined' && console.log) {
            console.log('Config check - GAS_API_URL:', typeof GAS_API_URL !== 'undefined' ? GAS_API_URL : 'undefined');
        }
    </script>
    <script src="app.js"></script>
</head>
<body>
    <div class="container">
        <h1>予約管理システム</h1>
        <div id="connectionStatus" style="display:none; background-color:#fff3cd; border:1px solid #ffeaa7; padding:10px; margin-bottom:20px; border-radius:4px;">
            <strong>接続状況:</strong> <span id="statusText">確認中...</span>
            <div id="debugInfo" style="margin-top:10px; font-size:0.9em; color:#666;">
                <div>設定URL: <span id="configUrl">未設定</span></div>
                <div>エラー詳細: <span id="errorDetails">なし</span></div>
            </div>
        </div>
        <div id="helpInfo" style="display:none; background-color:#e7f3ff; border:1px solid #b3d9ff; padding:15px; margin-bottom:20px; border-radius:4px; font-size:0.9em;">
            <strong>設定方法:</strong><br>
            1. Google Apps ScriptでWebアプリとして公開してください<br>
            2. アクセス権限を「全員（匿名ユーザーを含む）」に設定してください<br>
            3. スプレッドシートに「メニュー」シートを作成し、コース情報を入力してください<br>
            <div style="margin-top:10px; font-size:0.8em; color:#666;">
                ヘッダー行: A列「コース名」、B列「施術時間（分）」、C列「価格（円）」
            </div>
            <div style="margin-top:10px; font-size:0.8em; color:#d63384;">
                <strong>接続エラーの場合:</strong><br>
                • Google Apps ScriptのURLが正しいか確認<br>
                • Webアプリとして公開されているか確認<br>
                • アクセス権限が「全員」に設定されているか確認<br>
                • ブラウザのコンソールでエラー詳細を確認
            </div>
            <div style="margin-top:10px;">
                <button type="button" onclick="testConnection()" style="padding:5px 10px; background-color:#007bff; color:white; border:none; border-radius:3px; cursor:pointer; margin-right:10px;">
                    接続テスト
                </button>
                <button type="button" onclick="testDirectAccess()" style="padding:5px 10px; background-color:#28a745; color:white; border:none; border-radius:3px; cursor:pointer;">
                    直接アクセステスト
                </button>
            </div>
        </div>
        <div class="step-guide">
            <span class="step">Step 1:</span> コース・オフの有無を選択 → <span class="step">Step 2:</span> 日付を選択
            <p style="font-size:0.8em; margin-top:5px; color:#555;">※コース等を変更した場合は、再度日付をクリックしてください。</p>
        </div>

        <div class="main-form-group">
            <label for="courseSelect">ご希望のコース</label>
            <select id="courseSelect">
                <!-- スクリプトによって動的に読み込まれます -->
            </select>
            <div class="checkbox-group">
                <label><input type="checkbox" id="nailOffCheck"> ジェルオフ (+30分)</label>
            </div>
            <div class="checkbox-group" style="padding-top: 10px; border-top: none;">
                <label><input type="checkbox" id="lengthExtensionCheck"> 長さ出し</label>
                <div id="lengthExtensionOptions">
                    <select id="lengthExtensionCount"></select>
                </div>
            </div>
        </div>
        
        <div id='calendar'></div>
    </div>

    <!-- 時間選択モーダル -->
    <div id="timeSlotsModal" class="modal-overlay">
        <div class="modal-content">
            <h2 id="timeSlotsTitle"></h2>
            <p>ご希望の開始時間を選択してください。</p>
            <div id="timeSlotsContainer"></div>
            <div class="form-actions">
                <button type="button" id="timeSlotsCancelButton" class="btn-cancel">戻る</button>
            </div>
        </div>
    </div>

    <!-- 予約情報入力モーダル -->
    <div id="reservationModal" class="modal-overlay">
        <div class="modal-content">
            <h2>予約情報の入力</h2>
            <div class="form-group">
                <label>予約日時</label>
                <input type="text" id="selectedTime" readonly style="background:#eee;">
            </div>
            <div class="form-group">
                <label>ご予約内容</label>
                <div id="reservationSummary" style="padding: 10px 12px; background: #eee; border-radius: 4px; font-size: 0.95em; line-height: 1.5;"></div>
            </div>
            <div class="form-group">
                <label for="name">お名前</label>
                <input type="text" id="name" required>
            </div>
            <div class="form-group">
                <label for="email">メールアドレス</label>
                <input type="email" id="email" required>
            </div>
            <div class="form-group">
                <label for="phone">電話番号</label>
                <input type="tel" id="phone" required>
            </div>
            <div class="form-group">
                <label for="designImage">デザイン画像 (任意)</label>
                <input type="file" id="designImage" accept="image/*">
            </div>
            <div class="form-group">
                <label>MENU</label>
                <div class="radio-group">
                    <label><input type="radio" name="menu_type" value="HAND" checked> HAND</label>
                    <label><input type="radio" name="menu_type" value="FOOT"> FOOT</label>
                </div>
            </div>
            <div class="form-group">
                <label>ご来店回数</label>
                <div class="radio-group">
                    <label><input type="radio" name="visit" value="初回" checked> 初回</label>
                    <label><input type="radio" name="visit" value="2回目以降"> 2回目以降</label>
                </div>
            </div>
            <div class="form-group">
                <label>担当者指名</label>
                <div class="radio-group">
                    <label><input type="radio" name="staff_assignment" value="指名なし" checked> 指名なし</label>
                    <label><input type="radio" name="staff_assignment" value="指名あり"> 指名あり (+400円)</label>
                </div>
                <div id="staffSelectionContainer" style="display: none; margin-top: 10px;">
                    <select id="staffSelect" style="width: 100%; padding: 10px; border: 1px solid #ccc; border-radius: 4px;">
                        <option value="">担当者を選択してください</option>
                        <option value="スタッフA">かのん</option>
                        <option value="スタッフB">しの</option>
                        <option value="スタッフC">りな</option>
                    </select>
                </div>
            </div>
            <div class="form-actions">
                <button type="button" id="cancelButton" class="btn-cancel">キャンセル</button>
                <button type="button" id="submitButton" class="btn-submit">予約を確定する</button>
            </div>
        </div>
    </div>
</body>
</html>