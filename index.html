<!DOCTYPE html>
<html lang="ja">
<head>
    <base target="_top">
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="ネイルサロンCARATの予約管理システム。オンラインで簡単にご予約いただけます。">
    <meta name="keywords" content="ネイルサロン,予約,オンライン予約,CARAT,大阪">
    <meta name="author" content="CARAT">
    <meta name="robots" content="index, follow">
    
    <!-- Open Graph / Facebook -->
    <meta property="og:type" content="website">
    <meta property="og:title" content="予約管理システム - CARAT">
    <meta property="og:description" content="ネイルサロンCARATの予約管理システム。オンラインで簡単にご予約いただけます。">
    <meta property="og:url" content="https://your-username.github.io/your-repo-name">
    
    <!-- Twitter -->
    <meta property="twitter:card" content="summary_large_image">
    <meta property="twitter:title" content="予約管理システム - CARAT">
    <meta property="twitter:description" content="ネイルサロンCARATの予約管理システム。オンラインで簡単にご予約いただけます。">
    
    <!-- Favicon -->
    <link rel="icon" type="image/x-icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>💅</text></svg>">
    
    <!-- PWA Manifest -->
    <link rel="manifest" href="manifest.json">
    <meta name="theme-color" content="#007bff">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">
    <meta name="apple-mobile-web-app-title" content="CARAT予約">
    
    <!-- Preload critical resources -->
    <link rel="preload" href="https://cdn.jsdelivr.net/npm/fullcalendar@6.1.15/index.global.min.js" as="script">
    <link rel="preload" href="styles.css" as="style">
    <link rel="preload" href="app.js" as="script">
    
    <script src='https://cdn.jsdelivr.net/npm/fullcalendar@6.1.15/index.global.min.js' defer></script>
    <link rel="stylesheet" href="styles.css">
    <script>
        // Instagram内のWebブラウザで開かれた場合に標準ブラウザで開くようにリダイレクト
        (function() {
            // Instagram内のWebブラウザを検出
            function isInstagramBrowser() {
                // Instagram内のWebブラウザの特徴を検出
                const userAgent = navigator.userAgent.toLowerCase();
                const isInstagram = userAgent.includes('instagram') || 
                                   userAgent.includes('igwebview') ||
                                   userAgent.includes('instagramwebview');
                
                // 画面サイズやその他の特徴もチェック
                const isMobile = /android|iphone|ipad|ipod|blackberry|windows phone/i.test(userAgent);
                const isInApp = window.navigator.standalone || 
                               document.referrer.includes('instagram.com') ||
                               window.location.href.includes('instagram.com');
                
                return isInstagram || (isMobile && isInApp);
            }
            
            // Instagram内のブラウザで開かれた場合の処理
            if (isInstagramBrowser()) {
                // 現在のURLを取得
                const currentUrl = window.location.href;
                
                // 標準ブラウザで開くためのURLスキームを使用
                // iOSの場合
                if (/iphone|ipad|ipod/i.test(navigator.userAgent)) {
                    // Safariで開く
                    window.location.href = 'x-web-search://' + currentUrl;
                } 
                // Androidの場合
                else if (/android/i.test(navigator.userAgent)) {
                    // Chromeで開く
                    window.location.href = 'googlechrome://navigate?url=' + encodeURIComponent(currentUrl);
                }
                // その他の場合
                else {
                    // 新しいウィンドウで開く
                    window.open(currentUrl, '_system');
                }
                
                // リダイレクトが失敗した場合のフォールバック
                setTimeout(function() {
                    // リダイレクトが成功しなかった場合、ユーザーに手動で開くよう促す
                    if (document.hidden || document.webkitHidden) {
                        return; // ページが非表示になった場合はリダイレクト成功
                    }
                    
                    // 手動で開くためのガイダンスを表示
                    const message = document.createElement('div');
                    message.style.cssText = `
                        position: fixed;
                        top: 0;
                        left: 0;
                        width: 100%;
                        height: 100%;
                        background: rgba(0, 0, 0, 0.9);
                        color: white;
                        display: flex;
                        flex-direction: column;
                        justify-content: center;
                        align-items: center;
                        z-index: 9999;
                        text-align: center;
                        padding: 20px;
                        font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
                    `;
                    message.innerHTML = `
                        <h2 style="margin-bottom: 20px;">📱 ブラウザで開いてください</h2>
                        <p style="margin-bottom: 15px; line-height: 1.6;">
                            Instagram内のブラウザでは正常に動作しません。<br>
                            以下の方法で標準ブラウザで開いてください：
                        </p>
                        <div style="margin-bottom: 20px; padding: 15px; background: rgba(255,255,255,0.1); border-radius: 8px;">
                            <p style="margin-bottom: 10px;"><strong>iOSの場合：</strong></p>
                            <p>右上の「...」→「Safariで開く」をタップ</p>
                            <p style="margin-top: 10px;"><strong>Androidの場合：</strong></p>
                            <p>右上の「...」→「ブラウザで開く」をタップ</p>
                        </div>
                        <button onclick="window.open('${currentUrl}', '_blank')" 
                                style="padding: 12px 24px; background: #007bff; color: white; border: none; border-radius: 6px; font-size: 16px; cursor: pointer;">
                            新しいタブで開く
                        </button>
                    `;
                    document.body.appendChild(message);
                }, 2000);
            }
        })();
    </script>
    <script src="app.js" defer></script>
</head>
<body>
    <div class="container">
        <h1>予約管理システム</h1>
        <div class="step-guide">
            <span class="step">Step 1:</span> コース・オフの有無を選択 → <span class="step">Step 2:</span> 日付を選択
            <p style="font-size:0.8em; margin-top:5px; color:#555;">※コース等を変更した場合は、再度日付をクリックしてください。</p>
        </div>

        <div class="main-form-group">
            <label for="courseSelect">ご希望のコース</label>
            <select id="courseSelect">
                <!-- スクリプトによって動的に読み込まれます -->
            </select>
            <div class="checkbox-group">
                <label><input type="checkbox" id="nailOffCheck"> ジェルオフ (+30分)</label>
            </div>
            <div class="checkbox-group" style="padding-top: 10px; border-top: none;">
                <label><input type="checkbox" id="lengthExtensionCheck"> 長さ出し</label>
                <div id="lengthExtensionOptions">
                    <select id="lengthExtensionCount"></select>
                </div>
            </div>
        </div>
        
        <div id='calendar'></div>
    </div>

    <!-- 時間選択モーダル -->
    <div id="timeSlotsModal" class="modal-overlay">
        <div class="modal-content">
            <h2 id="timeSlotsTitle"></h2>
            <p>ご希望の開始時間を選択してください。</p>
            <div id="timeSlotsContainer"></div>
            <div class="form-actions">
                <button type="button" id="timeSlotsCancelButton" class="btn-cancel">戻る</button>
            </div>
        </div>
    </div>

    <!-- 予約情報入力モーダル -->
    <div id="reservationModal" class="modal-overlay">
        <div class="modal-content">
            <h2>予約情報の入力</h2>
            <div class="form-group">
                <label>予約日時</label>
                <input type="text" id="selectedTime" readonly style="background:#eee;">
            </div>
            <div class="form-group">
                <label>ご予約内容</label>
                <div id="reservationSummary" style="padding: 10px 12px; background: #eee; border-radius: 4px; font-size: 0.95em; line-height: 1.5;"></div>
            </div>
            <div class="form-group">
                <label for="name">お名前</label>
                <input type="text" id="name" required>
            </div>
            <div class="form-group">
                <label for="email">メールアドレス</label>
                <input type="email" id="email" required>
            </div>
            <div class="form-group">
                <label for="phone">電話番号</label>
                <input type="tel" id="phone" required>
            </div>
            <div class="form-group">
                <label for="designImage">デザイン画像 (任意)</label>
                <input type="file" id="designImage" accept="image/*">
            </div>
            <div class="form-group">
                <label>MENU</label>
                <div class="radio-group">
                    <label><input type="radio" name="menu_type" value="HAND" checked> HAND</label>
                    <label><input type="radio" name="menu_type" value="FOOT"> FOOT</label>
                </div>
            </div>
            <div class="form-group">
                <label>ご来店回数</label>
                <div class="radio-group">
                    <label><input type="radio" name="visit" value="初回" checked> 初回</label>
                    <label><input type="radio" name="visit" value="2回目以降"> 2回目以降</label>
                </div>
            </div>
            <div class="form-group">
                <label>担当者指名</label>
                <div class="radio-group">
                    <label><input type="radio" name="staff_assignment" value="指名なし" checked> 指名なし</label>
                    <label><input type="radio" name="staff_assignment" value="指名あり"> 指名あり (+400円)</label>
                </div>
                <div id="staffSelectionContainer" style="display: none; margin-top: 10px;">
                    <select id="staffSelect" style="width: 100%; padding: 10px; border: 1px solid #ccc; border-radius: 4px;">
                        <option value="">担当者を選択してください</option>
                        <option value="スタッフA">かのん</option>
                        <option value="スタッフB">しの</option>
                        <option value="スタッフC">りな</option>
                    </select>
                </div>
            </div>
            <div class="form-actions">
                <button type="button" id="cancelButton" class="btn-cancel">キャンセル</button>
                <button type="button" id="submitButton" class="btn-submit">予約を確定する</button>
            </div>
        </div>
    </div>
</body>
</html>